{% extends 'exp/base.html' %}
{% load bootstrap3 %}
{% load exp_extras %}

{% block title %}{{ user.get_full_name }}{% endblock %}
{% block flash %}
  {% bootstrap_messages %}
{% endblock %}
{% block content %}
  <div class="container mb-lg">
      <div class="row">
          <div class="col-xs-12">
              <a href="{% url 'exp:participant-list' %}"> All Participants </a> &gt; {{ user.given_name }} </a>
          </div>
      </div>

      <div class="row">
          <div class="col-xs-12">
              <h1> {{ user.identicon_html }} {{ user.given_name }} </h1>
              <span><label class='pr-xs'> Last Active: </label> {{ user.last_login|date:"n/d/Y"|default:"N/A" }} </span>
          </div>
      </div>

    <div class='row'>
        <div class='col-md-6 col-sm-5'>
            <h3>Children</h3>
            {% for child in user.children.all %}
            <div class="pb-md">
                <h4 class="child-name"><em>{{child.given_name}}</em></h4>
                <div class="pl-md">
                    <div class="row">
                        <div class="col-xs-5">
                            <b> Birthday: </b>
                        </div>
                        <div class="col-xs-7">
                            {{child.birthday|date:"n/d/Y"|default:"N/A"}}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-5">
                            <b> Age: </b>
                        </div>
                        <div class="col-xs-7">
                             {{child.birthday | timesince}}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-5">
                            <b> Gender: </b>
                        </div>
                        <div class="col-xs-7">
                             {{child.get_gender_display}}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-5">
                            <b> Gestational Age at Birth: </b>
                        </div>
                        <div class="col-xs-7">
                             {{child.age_at_birth|default:"No response"}}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-5">
                            <b> Additional Info: </b>
                        </div>
                        <div class="col-xs-7">
                             {{child.additional_information|default:"No response"}}
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
                <p><em> No children profiles registered! </em></p>
            {% endfor %}
        </div>
        <div class='col-md-6 col-sm-7'>
            <h3>Latest Demographic Data</h3>
            <div class="row">
                <div class="col-xs-5">
                    <b> Country: </b>
                </div>
                <div class="col-xs-7">
                    {{ demographics.country|default:"No Response" }}
                </div>
            </div>
            <div class="row">
                <div class="col-xs-5">
                    <b> State: </b>
                </div>
                <div class="col-xs-7">
                     {{ demographics.state|default:"No Response" }}
                </div>
            </div>
            <div class="row">
                <div class="col-xs-5">
                    <b> Area description: </b>
                </div>
                <div class="col-xs-7">
                    {{ demographics.density|default:"No Response" }}
                </div>
            </div>
            <div class="row">
                <div class="col-xs-5">
                    <b> Laguages Spoken at Home: </b>
                </div>
                <div class="col-xs-7">
                    {{ demographics.languages_spoken_at_home|default:"No Response" }}
                </div>
            </div>
            <div class="row">
                <div class="col-xs-5">
                    <b> Number of Children: </b>
                </div>
                <div class="col-xs-7">
                     {{ demographics.number_of_children|default:"No Response" }}
                </div>
            </div>
            <div class="row">
                <div class="col-xs-5">
                    <b>  Children Birthdays: </b>
                </div>
                <div class="col-xs-7">
                    {% for birthday in user.latest_demographics.child_birthdays %}{{birthday|date:"n/d/Y"|default:"N/A"}}{% if not forloop.last %}, {% endif %}{% empty %} No Response{% endfor %}
                </div>
            </div>
            <div class="row">
                <div class="col-xs-5">
                    <b> Number of Guardians: </b>
                </div>
                <div class="col-xs-7">
                    {{ demographics.number_of_guardians|default:"No Response" }}
                </div>
            </div>
            <div class="row">
                <div class="col-xs-5">
                    <b> Explanation for Guardians: </b>
                </div>
                <div class="col-xs-7">
                    {{ demographics.number_of_guardians_explanation|default:"No Response" }}
                </div>
            </div>
            <div class="row">
                <div class="col-xs-5">
                    <b> Race: </b>
                </div>
                <div class="col-xs-7">
                    {{ demographics.race_identification|default:"No Response" }}
                </div>
            </div>
            <div class="row">
                <div class="col-xs-5">
                    <b> Age: </b>
                </div>
                <div class="col-xs-7">
                    {{ demographics.age|default:"No Response" }}
                </div>
            </div>
            <div class="row">
                <div class="col-xs-5">
                    <b> Gender: </b>
                </div>
                <div class="col-xs-7">
                    {{ demographics.gender|default:"No Response" }}
                </div>
            </div>
            <div class="row">
                <div class="col-xs-5">
                    <b> Education Level: </b>
                </div>
                <div class="col-xs-7">
                    {{ demographics.education_level|default:"No Response" }}
                </div>
            </div>
            <div class="row">
                <div class="col-xs-5">
                    <b> Spouse's Education Level: </b>
                </div>
                <div class="col-xs-7">
                    {{ demographics.spouse_education_level|default:"No Response" }}
                </div>
            </div>
            <div class="row">
                <div class="col-xs-5">
                    <b> Annual Income: </b>
                </div>
                <div class="col-xs-7">
                    {{ demographics.annual_income|default:"No Response" }}
                </div>
            </div>
            <div class="row">
                <div class="col-xs-5">
                    <b> Children's Books at Home: </b>
                </div>
                <div class="col-xs-7">
                    {{ demographics.number_of_books|default:"No Response" }}
                </div>
            </div>
            <div class="row">
                <div class="col-xs-5">
                    <b> Additional Comments: </b>
                </div>
                <div class="col-xs-7">
                    {{ demographics.additional_comments|default:"No Response" }}
                </div>
            </div>
        </div>
    </div>
    <hr>
    <h3>{{ user.given_name}}'s Studies</h3>
    {% if studies %}
            <div class="row hidden-xs hidden-sm pt-sm">
                <div class="col-md-4 col-xs-12">
                    Study Title
                    <a class="pl-sm" aria-label="Sort user studies by name" href="{% url 'exp:participant-detail' user.id  %}?{% query_transform request page='1' sort='name' %}"><i aria-hidden="true" class="fa fa-chevron-up" role="button" name="name"></i></a>
                    <a aria-label="Reverse sort user studies by name" href="{% url 'exp:participant-detail' user.id  %}?{% query_transform request page='1' sort='-name' %}"><i aria-hidden="true" class="fa fa-chevron-down" role="button" name="name"></i></a>
                </div>
                <div class="col-md-1 col-xs-12">
                    Response
                </div>
                <div class="col-md-1 col-xs-12">
                    Child
                </div>
                <div class="col-md-3 col-xs-12">
                    Completion Status
                    <a aria-label="Sort user studies by completion status" class="pl-sm" href="{% url 'exp:participant-detail' user.id  %}?{% query_transform request page='1' sort='completed' %}"><i aria-hidden="true" class="fa fa-chevron-up" role="button" name="name"></i></a>
                    <a aria-label="Reverse sort user studies by completion status" href="{% url 'exp:participant-detail' user.id  %}?{% query_transform request page='1' sort='-completed' %}"><i aria-hidden="true" class="fa fa-chevron-down" role="button" name="name"></i></a>
                </div>
                <div class="col-md-3 col-xs-12">
                    Date Modified
                    <a aria-label="Sort user studies by date modified" class="pl-sm" href="{% url 'exp:participant-detail' user.id  %}?{% query_transform request page='1' sort='date_modified' %}"><i aria-hidden="true" class="fa fa-chevron-up" role="button" name="name"></i></a>
                    <a aria-label="Reverse sort user studies by date modified" href="{% url 'exp:participant-detail' user.id  %}?{% query_transform request page='1' sort='-date_modified' %}"><i aria-hidden="true" class="fa fa-chevron-down" role="button" name="name"></i></a>
                </div>
                <hr>
            </div>
            <div class="row mt-xs visible-xs visible-sm">
                <div class="col-xs-12 mt-lg mb-lg">
                    <div class="btn-group">
                        <div class="btn-group">
                          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                             Title <span class="caret"></span>
                          </button>
                          <ul class="dropdown-menu" role="menu">
                            <li> <a aria-label="Sort ascending by study name" href="{% url 'exp:participant-detail' user.id  %}?{% query_transform request page='1' sort='name' %}">Sort A-Z</a></li>
                            <li> <a aria-label="Sort descending by study name" href="{% url 'exp:participant-detail' user.id  %}?{% query_transform request page='1' sort='-name' %}">Sort Z-A</a></li>
                          </ul>
                      </div>
                      <div class="btn-group">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                            Status <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu">
                          <li><a aria-label="Sort ascending by completion status" href="{% url 'exp:participant-detail' user.id  %}?{% query_transform request page='1' sort='completed' %}">Sort A-Z </a></li>
                          <li><a aria-label="Sort descending by completion status" href="{% url 'exp:participant-detail' user.id  %}?{% query_transform request page='1' sort='-completed' %}">Sort Z-A </a></li>
                        </ul>
                      </div>
                      <div class="btn-group">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                            Modified <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu">
                          <li><a aria-label="Sort ascending by date modified" href="{% url 'exp:participant-detail' user.id  %}?{% query_transform request page='1' sort='date_modified' %}">Sort Asc</a></li>
                          <li><a aria-label="Sort descending by date modified" href="{% url 'exp:participant-detail' user.id  %}?{% query_transform request page='1' sort='-date_modified' %}">Sort Desc</a></li>
                        </ul>
                      </div>
                   </div>
                </div>
            </div>
            {% for study_dict in studies %}
            <div class="row pt-md">
                <div class="col-md-4 col-xs-12">
                    <a href="{% url 'exp:study-detail' study_dict.study.id %}">{{ study_dict.study.name }}</a>
                </div>
                <div class="col-md-1 col-xs-12">
                    <span class="visible-xs visible-sm">Response ID: {{ study_dict.response.id }} </span>
                    <span class="hidden-xs hidden-sm">{{ study_dict.response.id }} </span>
                </div>
                <div class="col-md-1 col-xs-12">
                    <span class="visible-xs visible-sm">Child ID: {{ study_dict.response.child.id }} </span>
                    <span class="hidden-xs hidden-sm">{{ study_dict.response.child.id }} </span>
                </div>
                <div class="col-md-3 col-xs-12">

                    {% if study_dict.completed %}
                        <span class="visible-xs visible-sm">Status: Completed </span>
                        <span class="hidden-xs hidden-sm">Completed </span>
                    {% else %}
                        <span class="visible-xs visible-sm">Status: In Progress </span>
                        <span class="hidden-xs hidden-sm">In Progress </span>
                    {% endif %}
                </div>
                <div class="col-md-3 col-xs-12">
                    <span class="visible-xs visible-sm">Date Modified: {{ study_dict.modified |date:"n/d/Y"|default:"N/A" }} </span>
                    <span class="hidden-xs hidden-sm">{{ study_dict.modified |date:"n/d/Y"|default:"N/A" }} </span>
                </div>
            </div>
          {% endfor %}
    {% else %}
      <p><em> {{ user.given_name }} has not participated in any studies yet! </em></p>
    {% endif %}
    <div class="row pt-xl">
        <div class="col-md-11 col-md-offset-1">
            <div class="pull-right">
                {% include 'studies/_paginator.html' with items=studies request=request %}
            </div>
        </div>
    </div>
  </div>
</div>
{% endblock %}
